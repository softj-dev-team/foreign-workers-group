<html lang="ko" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="fragments/layout">

<th:block layout:fragment="layout-content">
    <div class="wrap2">
        <div class="header white big">
            <div class="hd-in">

                <a href="javascript:history.back()"class="back back-btn"></a>
                <button class="btn">Submit</button>
            </div>
        </div>
        <div class="board-wrap write">
            <input type="text" class="note-title" placeholder="Title">
            <textarea id="summernote"></textarea>
        </div>
    </div>
    <script>
        //summernote
       $(document).ready(function (){
            $('#summernote').summernote({
                tabsize: 2,
                lang: 'ko-KR', // default: 'en-US'
                toolbar: [
                    ['insert', ['picture']],
                    ['style', ['bold', 'forecolor', 'fontsize']],
                    ['insert', ['link', 'file']]
                ],
                spellCheck: false,
                placeholder: 'Type...',
                disableDragAndDrop: true,
                disableResizeEditor: true,
                icons: {
                    picture: 'i-img',
                    bold: 'i-bold',
                    link: 'i-link',
                    file: 'i-file'
                },
                callbacks: {
                    onFileUpload: function(file) {
                        myOwnCallBack(file[0]);
                    },
                },
            });
        });
        function myOwnCallBack(file) {
            let data = new FormData();
            data.append("file", file);
            $.ajax({
                data: data,
                type: "POST",
                url: "file-uploader.php", //Your own back-end uploader
                cache: false,
                contentType: false,
                processData: false,
                xhr: function() { //Handle progress upload
                    let myXhr = $.ajaxSettings.xhr();
                    if (myXhr.upload) myXhr.upload.addEventListener('progress', progressHandlingFunction, false);
                    return myXhr;
                },
                success: function(reponse) {
                    if(reponse.status === true) {
                        let listMimeImg = ['image/png', 'image/jpeg', 'image/webp', 'image/gif', 'image/svg'];
                        let listMimeAudio = ['audio/mpeg', 'audio/ogg'];
                        let listMimeVideo = ['video/mpeg', 'video/mp4', 'video/webm'];
                        let elem;

                        if (listMimeImg.indexOf(file.type) > -1) {
                            //Picture
                            $('.summernote').summernote('editor.insertImage', reponse.filename);
                        } else if (listMimeAudio.indexOf(file.type) > -1) {
                            //Audio
                            elem = document.createElement("audio");
                            elem.setAttribute("src", reponse.filename);
                            elem.setAttribute("controls", "controls");
                            elem.setAttribute("preload", "metadata");
                            $('.summernote').summernote('editor.insertNode', elem);
                        } else if (listMimeVideo.indexOf(file.type) > -1) {
                            //Video
                            elem = document.createElement("video");
                            elem.setAttribute("src", reponse.filename);
                            elem.setAttribute("controls", "controls");
                            elem.setAttribute("preload", "metadata");
                            $('.summernote').summernote('editor.insertNode', elem);
                        } else {
                            //Other file type
                            elem = document.createElement("a");
                            let linkText = document.createTextNode(file.name);
                            elem.appendChild(linkText);
                            elem.title = file.name;
                            elem.href = reponse.filename;
                            $('.summernote').summernote('editor.insertNode', elem);
                        }
                    }
                }
            });
        }

        function progressHandlingFunction(e) {
            if (e.lengthComputable) {
                //Log current progress
                console.log((e.loaded / e.total * 100) + '%');

                //Reset progress on complete
                if (e.loaded === e.total) {
                    console.log("Upload finished.");
                }
            }
        }
        $(function(){
            $('#all-chk').click(function(){
                var chk = $(this).is(':checked');
                if(chk) $('.file-up-con input').prop('checked',true);
                else $('.file-up-con input').prop('checked',false);
            });
        });
        $('.ch-remove').click(function(){
            if(confirm("삭제하시겠습니까?")){
                $(".file-up-con input[type=checkbox]:checked").each(function(){
                    var tr_value =$(this).val();
                    var tr=$("li[file-value='"+tr_value+"']");
                    tr.remove();
                });
            }else{
                return false;
            }
        });
        
    </script>
    <script>
    /* 0. variable */

    /* 1. on load */
    $(function(){
    /* 2.init*/

    /* 3. event listener*/

    })

    /* 4. function */
    </script>
</th:block>